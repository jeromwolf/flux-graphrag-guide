// ============================================================
// 0단계 미니 데모 — 핵심 질의 모음
// Stage 0 Mini Demo — Core Queries
// ──────────────────────────────────
// Neo4j Browser에서 하나씩 실행해보세요
// ============================================================


// ─────────────────────────────────────────
// 질의 0: 전체 그래프 보기 (Overview)
// "우리가 만든 그래프 전체를 보여줘"
// ─────────────────────────────────────────

MATCH (n) RETURN n;

// 💡 Neo4j Browser에서 그래프 시각화로 전환하면
//    노드 7개, 관계 8개의 전체 구조가 한눈에 보입니다


// ─────────────────────────────────────────
// 질의 1: 공정 흐름 확인 (Process Flow)
// "브레이크 패드 공정 순서가 어떻게 되지?"
// ─────────────────────────────────────────

MATCH path = (start:Process)-[:NEXT*]->(end:Process)
WHERE NOT ()<-[:NEXT]-(start)
RETURN [n IN nodes(path) | n.name] AS 공정흐름;

// 예상 결과: ["혼합 (Mixing)", "열압착 (Hot Press)", "연마 (Grinding)"]


// ─────────────────────────────────────────
// ⭐ 질의 2: 결함 근본원인 추적 (Root Cause Analysis)
// "접착 박리 결함의 원인 공정과 설비는?"
// ─────────────────────────────────────────
// 이것이 GraphRAG의 핵심 가치!
// 벡터 RAG로는 이 3-hop 관계를 추적할 수 없습니다.
// ─────────────────────────────────────────

MATCH (d:Defect {name: '접착 박리 (Delamination)'})-[:DETECTED_AT]->(i:Inspection)
      -[:INSPECTS]->(p:Process)-[:USES_EQUIPMENT]->(e:Equipment)
RETURN d.name AS 결함명,
       d.severity AS 심각도,
       i.name AS 발견검사,
       p.name AS 원인공정,
       e.name AS 원인설비;

// 예상 결과:
// ┌──────────────────────┬─────────┬───────────────────────┬─────────────────────┬──────────────────────────────┐
// │ 결함명               │ 심각도   │ 발견검사              │ 원인공정            │ 원인설비                      │
// ├──────────────────────┼─────────┼───────────────────────┼─────────────────────┼──────────────────────────────┤
// │ 접착 박리            │ Critical│ 전단강도 시험          │ 열압착 (Hot Press)   │ 열압착 프레스 HP-01           │
// └──────────────────────┴─────────┴───────────────────────┴─────────────────────┴──────────────────────────────┘


// ─────────────────────────────────────────
// 질의 3: 직접 원인 조회 (Direct Cause)
// "접착 박리의 원인으로 지목된 것들은?"
// ─────────────────────────────────────────

MATCH (d:Defect {name: '접착 박리 (Delamination)'})-[r:CAUSED_BY_PROCESS|CAUSED_BY_EQUIPMENT]->(cause)
RETURN d.name AS 결함명,
       type(r) AS 원인유형,
       cause.name AS 원인;

// 예상 결과:
// │ 접착 박리 │ CAUSED_BY_PROCESS   │ 열압착 (Hot Press)          │
// │ 접착 박리 │ CAUSED_BY_EQUIPMENT │ 열압착 프레스 HP-01          │


// ─────────────────────────────────────────
// 질의 4: 설비 영향 분석 (Impact Analysis)
// "HP-01 설비가 관련된 모든 것을 보여줘"
// ─────────────────────────────────────────

MATCH (e:Equipment {name: '열압착 프레스 HP-01 (Hot Press HP-01)'})<-[r]-(connected)
RETURN e.name AS 설비,
       type(r) AS 관계,
       labels(connected)[0] AS 연결노드유형,
       connected.name AS 연결노드;

// 예상 결과: 열압착 공정(USES_EQUIPMENT), 접착 박리(CAUSED_BY_EQUIPMENT) 등


// ─────────────────────────────────────────
// 질의 5: 전체 경로 시각화 (Full Path)
// "결함부터 원자재까지 전체 연결을 보여줘"
// ─────────────────────────────────────────

MATCH path = (d:Defect)-[*1..4]-(connected)
WHERE d.name = '접착 박리 (Delamination)'
RETURN path;

// 💡 이 쿼리를 Neo4j Browser에서 실행하면
//    결함을 중심으로 뻗어나가는 전체 그래프를 시각화로 볼 수 있습니다


// ============================================================
// 🎓 학습 포인트
// ============================================================
//
// 1. 질의 2가 핵심입니다 — 3-hop 추적이 GraphRAG의 존재 이유
//    "결함 → 검사 → 공정 → 설비" 이 체인을 벡터 RAG로는 못 합니다
//
// 2. 노드가 7개뿐인데도 의미 있는 추론이 가능합니다
//    → 구조(관계)가 중요하지, 데이터 양이 중요한 게 아닙니다
//
// 3. 1단계에서는 이 그래프를 35개 노드로 확장합니다
//    → 결함 4종, 공정 7단계, 설비 7대, 작업자 3조...
//    → ../stage-1-education/ 참조
// ============================================================
